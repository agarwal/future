open build/Common
open ./etc/OCaml

PROJECT = future
OPAM_PACKAGE_NAME = $(PROJECT)
VERSION = dev

PACKAGES(x) =
  switch $(x)
  case unix
    return core cfstream
  case async-unix
    return $(PACKAGES unix) async
  case lwt-unix
    return $(PACKAGES unix) lwt.preemptive lwt.ppx
  default
    eprintln(PACKAGES undefined for $(x).)
    exit(1)

LIB_DEPS(x) =
  switch $(x)
  case unix
    return $(EMPTY)
  case lwt-unix
    return unix
  case async-unix
    return unix
  default
    eprintln(LIB_DEPS undefined for $(x).)
    exit(1)

MerlinFile()
METAFile()
OpamInstallFile($(EMPTY))
CleanCommands()

.SUBDIRS: .
  foreach(x => ..., $(LIBS))
    OCamlLibrary($(x))
